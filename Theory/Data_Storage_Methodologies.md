# Data Lake & DWH

## Data Lake (озеро данных)
<image src="https://github.com/NikGerasimovich/Data-engineering/blob/main/Theory/IMAGE/Data-Lake-Architecture.png" alt="Data lake">

### Что это?
Хранилище данных, которое позволяет сохранять данные в их изначальном или почти изначальном виде, независимо от структуры.

### Примеры данных
- Логи, JSON, CSV
- Изображения, видео
- Данные из IoT-устройств

### Формат хранения
- Amazon S3
- Azure Blob Storage
- Hadoop Distributed File System (HDFS)

### Ключевые особенности
- Хранение данных в "сыром" виде
- Поддержка различных типов данных
- **Schema-on-read**: данные структурируются только при обработке

---

## Data Warehouse (DWH, хранилище данных)

<image src="https://github.com/NikGerasimovich/Data-engineering/blob/main/Theory/IMAGE/DWH-architecture.jpg" alt="dwh">

### Что это?
Централизованное хранилище структурированных данных, оптимизированное для аналитических запросов.

### Примеры данных
- Транзакции
- Отчёты о продажах
- Агрегированные данные

### Формат хранения
- Реляционные базы данных (SQL)
- Snowflake, Google BigQuery, Amazon Redshift

### Ключевые особенности
- Данные предварительно обработаны
- **Schema-on-write**: структура определяется заранее
- Высокая производительность аналитических запросов

---

## Применение

### Data Lake
**Сферы применения:**
- Data Science, машинное обучение
- Анализ неструктурированных данных
- Хранение больших объемов "сырого" материала

**Примеры:**
- Хранение логов
- Сохранение IoT-данных
- Модели Data Science

### Data Warehouse
**Сферы применения:**
- BI (Business Intelligence)
- Подготовка отчетов
- Аналитика продаж

**Примеры:**
- Ежемесячные бизнес-отчеты
- Системы прогнозирования

---

## Плюсы и минусы

| Характеристика        | Data Lake                                         | Data Warehouse                                 |
|-----------------------|--------------------------------------------------|-----------------------------------------------|
| **Плюсы**             | Гибкость, масштабируемость, низкая стоимость      | Высокая производительность, структурированность |
| **Минусы**            | Сложность управления, медленная обработка         | Высокая стоимость, ограничения по типам данных |

---

## Сравнение

| Характеристика      | Data Lake                | Data Warehouse         |
|---------------------|--------------------------|-------------------------|
| **Тип данных**      | Сырой, неструктурированный | Структурированный       |
| **Схема**           | Schema-on-read           | Schema-on-write         |
| **Производительность** | Низкая для аналитики    | Высокая для аналитики   |
| **Стоимость**       | Низкая                   | Высокая                 |

---

## Вывод
- **Data Lake**: подходит для "сырых" данных, глубокого анализа и машинного обучения.
- **Data Warehouse**: идеален для стандартной бизнес-аналитики.
- **Data Lakehouse**: объединяет преимущества обоих подходов.

---

# Schema-on-Read и Schema-on-Write

<image src="https://github.com/NikGerasimovich/Data-engineering/blob/main/Theory/IMAGE/schema_read_write.png" alt="read_wrire">

## Schema-on-Read
**Описание:** Схема данных определяется при чтении или обработке.
- Пример: Анализ логов или данных из IoT.
- **Плюсы:** Гибкость, минимальная обработка при загрузке.
- **Минусы:** Более сложная обработка данных при чтении.

## Schema-on-Write
**Описание:** Схема задаётся до записи в хранилище.
- Пример: BI-отчёты или CRM-системы.
- **Плюсы:** Высокая производительность запросов.
- **Минусы:** Высокие затраты на предварительную обработку.

---

## Сравнение

| Характеристика      | Schema-on-Read        | Schema-on-Write        |
|---------------------|-----------------------|-------------------------|
| **Момент задания схемы** | При чтении           | При записи              |
| **Гибкость**        | Высокая               | Низкая                  |
| **Производительность** | Зависит от обработки  | Высокая                 |

---

## Schema-on-Read vs Schema-on-Write

### Schema-on-Read
**Определение:**
- Схема данных применяется в момент их чтения, а не записи.
- Данные сохраняются в своём оригинальном виде, без необходимости заранее определять структуру.

**Ключевые особенности:**
- Гибкость: позволяет работать с разными форматами данных без предварительной обработки.
- Подходит для анализа и исследований, где данные могут быть необработанными.
- Часто используется в Data Lake.

**Преимущества:**
- Возможность изменения структуры данных на этапе анализа.
- Поддержка разнообразных типов данных: структурированных, полу-структурированных, неструктурированных.
- Быстрое добавление новых данных.

**Недостатки:**
- Медленная обработка аналитических запросов.
- Возможны ошибки в структуре данных, что может привести к проблемам с качеством данных.
- Требуется высокая квалификация аналитиков или инженеров данных.

---

### Schema-on-Write
**Определение:**
- Схема данных определяется на этапе записи данных в хранилище.
- Данные очищаются, преобразуются и организуются до их сохранения.

**Ключевые особенности:**
- Строгость: структура данных жёстко фиксирована.
- Высокая производительность при выполнении аналитических запросов.
- Используется в Data Warehouse.

**Преимущества:**
- Оптимизация для быстрого выполнения запросов.
- Гарантированное качество данных благодаря строгой обработке на этапе загрузки.
- Интеграция с традиционными BI-инструментами.

**Недостатки:**
- Ограниченная гибкость: изменение схемы требует значительных усилий.
- Процесс загрузки данных может быть долгим и трудоёмким.
- Невозможно хранить данные в их "сыром" виде.

---

### Сравнение

| Характеристика        | Schema-on-Read                     | Schema-on-Write                     |
|-----------------------|------------------------------------|-------------------------------------|
| **Определение схемы** | На этапе чтения                   | На этапе записи                    |
| **Гибкость**          | Высокая                          | Низкая                             |
| **Тип данных**        | Любой (включая неструктурированный) | Структурированный                  |
| **Скорость обработки**| Медленная                        | Быстрая                            |
| **Область применения**| Data Lake                        | Data Warehouse                     |

---

### Вывод:
- **Schema-on-Read** лучше подходит для исследовательской аналитики и работы с большими объёмами сырых данных, например, в Data Lake.
- **Schema-on-Write** идеально подходит для создания строгих аналитических систем и бизнес-отчетности, например, в Data Warehouse.
- Объединение этих подходов реализуется в **Data Lakehouse**, где данные сохраняются в сыром виде, но поддерживается возможность создания оптимизированных структур для аналитики.

---

## ETL и ELT

<image src="https://github.com/NikGerasimovich/Data-engineering/blob/main/Theory/IMAGE/etlelt.png" alt="etl_elt">

### ETL (Extract, Transform, Load)
ETL — это традиционный процесс обработки данных, включающий три этапа:
1. **Extract (Извлечение):** Сбор данных из различных источников, таких как базы данных, API или файловые системы.
2. **Transform (Преобразование):** Очистка, фильтрация, агрегирование, а также приведение данных к необходимой структуре.
3. **Load (Загрузка):** Запись обработанных данных в целевую систему, например, Data Warehouse.

**Применение ETL:**
- Подходит для Data Warehouse, где данные должны быть строго структурированы.
- Используется для бизнес-аналитики (BI), где важны агрегированные и очищенные данные.

**Примеры использования:**
- Создание отчетов о продажах.
- Интеграция данных из ERP-систем.
- Фильтрация данных для анализа.

---

### ELT (Extract, Load, Transform)
ELT — это подход, при котором данные загружаются в исходном виде в целевую систему (например, Data Lake), а их обработка выполняется уже внутри хранилища.

**Этапы ELT:**
1. **Extract (Извлечение):** Сбор данных из источников.
2. **Load (Загрузка):** Загрузка "сырых" данных в хранилище.
3. **Transform (Преобразование):** Выполнение преобразований с использованием ресурсов хранилища.

**Применение ELT:**
- Используется в Data Lake или современных Data Warehouse.
- Подходит для Big Data, где требуется гибкость и возможность работы с "сырыми" данными.

**Примеры использования:**
- Обработка логов и IoT-данных.
- Создание платформ для машинного обучения.
- Анализ больших объемов неструктурированных данных.

---

### Плюсы и минусы

| Характеристика            | **ETL**                                | **ELT**                               |
|---------------------------|-----------------------------------------|---------------------------------------|
| **Последовательность**    | Преобразование до загрузки             | Преобразование после загрузки         |
| **Целевое хранилище**     | Data Warehouse                         | Data Lake или современный Data Warehouse |
| **Тип данных**            | Структурированные                      | Любые (включая неструктурированные)   |
| **Гибкость**              | Низкая                                 | Высокая                               |
| **Производительность**    | Зависит от мощности ETL-системы        | Использует вычислительные мощности хранилища |
| **Инструменты**           | Apache NiFi, Talend, Informatica       | Apache Spark, dbt, SQL-скрипты        |
| **Затраты**               | Высокие на этапе подготовки            | Высокие на этапе анализа              |

---

### Вывод
- **ETL:** Оптимален для традиционных BI-систем, где важны структурированные и согласованные данные.
- **ELT:** Подходит для современных платформ, где критична скорость загрузки и гибкость анализа больших объемов данных.

Сегодня многие компании используют гибридные подходы, чтобы объединить преимущества ETL и ELT. Выбор подхода зависит от объемов данных, инфраструктуры и требований к обработке.

---

## Star Schema, Snowflake Schema и Data Vault

Эти схемы описывают организацию данных в хранилищах, особенно в контексте Data Warehouse, где важно оптимизировать данные для аналитических запросов.

### Схема "звезда" (Star Schema)
**Описание:**  
Схема "звезда" — это структура базы данных, в которой данные организованы вокруг одной или нескольких таблиц фактов (fact tables), связанных с несколькими таблицами измерений (dimension tables). Таблица фактов содержит ключевые метрики или события, а таблицы измерений содержат описание этих данных.

**Внешний вид:**  
Центр "звезды" — это таблица фактов, от которой расходятся "лучи" — таблицы измерений.

**Компоненты:**
- **Таблица фактов (Fact Table):** Хранит количественные данные (метрики), такие как количество продаж, доход или количество просмотров. Обычно большая по объёму и содержит ссылки на таблицы измерений.  
Пример колонок: sale_id, product_id, store_id, date_id, revenue, units_sold.
- **Таблицы измерений (Dimension Tables):** Содержат описательные атрибуты, такие как информация о продукте, данные о времени, характеристика клиента. Обычно маленькие, но с большим количеством колонок.  
Пример колонок:  
  - Таблица "Продукты": product_id, product_name, category, price.  
  - Таблица "Дата": date_id, year, month, day.

**Плюсы:**
- Простота: Легко понимать и использовать.
- Высокая производительность аналитических запросов из-за минимального числа связей между таблицами.
- Легко интегрируется с BI-инструментами.

**Минусы:**
- Избыточность данных: Атрибуты могут повторяться в измерениях, занимая лишнее место.
- Ограниченная гибкость: Трудно добавлять новые измерения или атрибуты без изменения структуры.

---

### Схема "снежинка" (Snowflake Schema)
**Описание:**  
Схема "снежинка" является расширением схемы "звезда". В ней таблицы измерений нормализованы, то есть разложены на подтаблицы для устранения избыточности. Это приводит к созданию более сложной сети таблиц.

**Внешний вид:**  
Похожа на снежинку из-за разветвлённой структуры нормализованных таблиц.

**Компоненты:**
- **Таблица фактов (Fact Table):** Такая же, как в схеме "звезда".
- **Таблицы измерений (Dimension Tables):** Разделены на подтаблицы. Например, "Продукты" могут быть связаны с отдельной таблицей "Категории", а "Даты" — с таблицей "Годы".  
Пример:  
  - Таблица "Продукты": product_id, product_name, category_id.  
  - Таблица "Категории": category_id, category_name.

**Плюсы:**
- Экономия места: Устраняется дублирование данных.
- Лучшая организация данных: Легче поддерживать изменения в атрибутах.

**Минусы:**
- Сложность запросов: Требуется больше соединений (joins), что может снижать производительность.
- Сложнее для восприятия и использования.

<image src="https://github.com/NikGerasimovich/Data-engineering/blob/main/Theory/IMAGE/Snowflake%20Schemas%20vs%20Star%20Schemas.png" alt="star_snowflake">

---

### Data Vault
**Описание:**  
Data Vault — это современный подход к построению хранилищ данных, который фокусируется на гибкости, масштабируемости и историчности данных. Данные организуются в три ключевых типа таблиц: хабы (hubs), сателлиты (satellites) и связи (links).

**Внешний вид:**  
Сложная структура, больше напоминающая сеть, чем традиционные схемы.

**Компоненты:**
- **Hubs (Хабы):** Основные сущности системы (ключевые бизнес-концепции), такие как клиент, продукт, заказ. Содержат уникальные бизнес-идентификаторы (business keys).  
Пример колонок: Таблица "Клиенты": customer_hub_id, customer_business_key, load_date, source.
- **Links (Связи):** Описывают связи между хабами. Обеспечивают возможность связывать бизнес-ключи из разных таблиц.  
Пример колонок: Таблица "Связь заказов и клиентов": order_link_id, customer_hub_id, order_hub_id, load_date.
- **Satellites (Сателлиты):** Хранят атрибуты хабов и связей, а также исторические изменения данных.  
Пример колонок: Таблица "Атрибуты клиентов": satellite_id, customer_hub_id, customer_name, customer_age, effective_date.

**Плюсы:**
- Гибкость: Легко добавлять новые источники данных и изменять структуру.
- Историчность: Поддерживается версия данных для анализа изменений.
- Масштабируемость: Хорошо подходит для больших систем с распределённой обработкой.

**Минусы:**
- Сложность: Требует значительных усилий для построения и управления.
- Производительность: Для аналитики требуется много соединений (joins).
- Высокие начальные затраты: Инженерное время и ресурсы.

<image src="https://github.com/NikGerasimovich/Data-engineering/blob/main/Theory/IMAGE/data_vault.png" alt="data_vault">

---

### Сравнение

| Характеристика           | **Звезда (Star)**              | **Снежинка (Snowflake)**          | **Data Vault**                   |
|--------------------------|--------------------------------|----------------------------------|----------------------------------|
| **Степень нормализации** | Де-нормализована               | Нормализована                    | Полностью нормализована         |
| **Сложность структуры**  | Простая                        | Средняя                          | Высокая                          |
| **Избыточность данных**  | Высокая                        | Низкая                           | Низкая                           |
| **Гибкость**             | Низкая                         | Средняя                          | Высокая                          |
| **Производительность**   | Высокая (меньше joins)         | Средняя                          | Низкая (много joins)            |
| **Историчность данных**  | Не поддерживается напрямую    | Не поддерживается напрямую      | Поддерживается                   |
| **Применение**           | BI-системы, стандартные отчёты | BI, где важна экономия места     | Большие, динамичные хранилища    |

---

### Вывод
- **Схема "звезда":** Проста в реализации и оптимальна для быстрых аналитических запросов, но не подходит для больших и динамичных систем.
- **Схема "снежинка":** Экономит место и предоставляет больше возможностей для расширения, но сложнее в настройке и может снизить производительность.
- **Data Vault:** Идеален для гибких систем, требующих историчности и масштабируемости, но требует больше ресурсов для настройки и управления.

Выбор схемы зависит от потребностей бизнеса, объёма данных и доступной инфраструктуры.
