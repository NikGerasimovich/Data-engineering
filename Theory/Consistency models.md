# Parquet, Avro, и ORC: Сравнение форматов хранения данных

**Parquet**, **Avro**, и **ORC** — популярные форматы хранения данных, используемые в распределённых системах обработки данных, таких как Hadoop, Spark, или облачных хранилищах (AWS S3, Google Cloud Storage). Каждый из них оптимизирован для определённых сценариев использования.

---

## 1. Parquet

### Описание:
Parquet — это **столбцовой (columnar)** формат данных, разработанный для аналитических нагрузок с большими объёмами данных.

### Ключевые особенности:
- **Столбцовая структура**:
  - Данные хранятся по столбцам, что оптимизирует выполнение операций сканирования и агрегации.
  - Только нужные столбцы загружаются в память, уменьшая объём обработки.
  
- **Эффективная компрессия**:
  - Используются алгоритмы, такие как Snappy или Gzip.
  - Компрессия эффективнее за счёт однородности данных в столбцах.

- **Поддержка сложных типов данных**:
  - Вложенные структуры, массивы и карты (structs, arrays, maps).

- **Оптимизация для чтения**:
  - Быстрое чтение нужных частей данных.

### Когда использовать:
- Аналитические запросы с большими объёмами данных.
- Хранилища данных (Data Lake).
- Проекты, где важна производительность чтения (Spark, Presto, Hive).

---

## 2. Avro

### Описание:
Avro — это **строковой (row-based)** формат данных, ориентированный на сериализацию и передачу данных.

### Ключевые особенности:
- **Фокус на сериализации**:
  - Данные хранятся в строковом виде, что делает формат идеальным для передачи через сеть.
  - Часто используется в системах обмена сообщениями (Kafka).

- **Схема данных (Schema)**:
  - Хранит схему в заголовке файла, что упрощает интеграцию данных между системами с разной структурой.

- **Производительность при записи**:
  - Быстрая запись и последовательное добавление данных.

- **Эффективность для потоковых данных**:
  - Используется в системах реального времени и потоковой передачи данных (Kafka, Flink).

- **Совместимость схемы**:
  - Поддержка обратной и прямой совместимости (например, добавление/удаление полей).

### Когда использовать:
- Потоковые системы (Kafka, Flink).
- Передача данных между сервисами в распределённых системах.
- Задачи, где важна высокая скорость записи.

---

## 3. ORC (Optimized Row Columnar)

### Описание:
ORC — это **столбцовой** формат, разработанный для хранения больших объёмов данных и сложных аналитических запросов.

### Ключевые особенности:
- **Оптимизация для Hive и Hadoop**:
  - Изначально создан для Hive, но также поддерживается в Spark.

- **Поддержка индексов**:
  - Хранит индексы, статистику и метаданные для каждого столбца, что ускоряет фильтрацию и выборку.

- **Эффективная компрессия**:
  - Поддержка предиктивной компрессии (run-length encoding, dictionary encoding).
  - Более компактные файлы по сравнению с Parquet в некоторых случаях.

- **Разделение данных на полосы (stripes)**:
  - Удобство обработки больших файлов.

- **Поддержка сложных типов данных**:
  - Эффективная работа с массивами, картами и структурами.

### Когда использовать:
- Сложные аналитические запросы в Hadoop или Hive.
- Хранилища данных с акцентом на компрессию и производительность при чтении.
- Проекты с большими объёмами данных.

---

<image src="https://raw.githubusercontent.com/NikGerasimovich/Data-engineering/refs/heads/main/Theory/IMAGE/DALL%C2%B7E%202024-12-02%2016.29.07%20-%20A%20high-quality%20infographic%20comparing%20big%20data%20formats_%20Avro%2C%20Parquet%2C%20and%20ORC.%20The%20chart%20has%20labeled%20sections%20for%20'Schema%20Evolution%20Support%2C'%20'Compres.webp" alt="prq">


## Сравнение Parquet, Avro и ORC

| **Характеристика**            | **Parquet**              | **Avro**                        | **ORC**                   |
|-------------------------------|--------------------------|---------------------------------|---------------------------|
| **Структура**                 | Столбцовая               | Строковая                       | Столбцовая                |
| **Компрессия**                | Эффективна (столбцы)     | Менее эффективна                | Очень эффективна          |
| **Производительность записи** | Умеренная                | Высокая                         | Умеренная                 |
| **Производительность чтения** | Высокая                  | Низкая                          | Очень высокая             |
| **Сложные типы данных**       | Поддерживаются           | Поддерживаются                  | Поддерживаются            |
| **Совместимость схемы**       | Умеренная                | Высокая                         | Низкая                    |
| **Сценарии использования**    | Аналитика, Data Lakes    | Потоковые системы, сериализация | Аналитика, Hadoop         |

---

## Как выбрать подходящий формат?

- **Avro**:
  - Используйте, если требуется быстрая запись или передача данных.
  - Идеально для систем реального времени, таких как Kafka.

- **Parquet**:
  - Подходит для аналитики с выборкой только нужных столбцов.
  - Оптимален для больших объёмов данных в системах Spark или Presto.

- **ORC**:
  - Оптимален для сложных аналитических запросов в системах Hadoop и Hive.
  - Максимизирует эффективность хранения и производительность чтения.

---

## Итог:
Выбор формата зависит от типа нагрузки:
- **Parquet** и **ORC** подходят для аналитики.  
- **Avro** лучше всего использовать для потоковых и сериализационных задач.
