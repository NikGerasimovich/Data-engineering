# AirFlow

Airflow — инструмент для разработки, планирования, мониторинга рабочих процессов и оркестрации данных.

## DAG (Ориентированный ациклический граф)
DAG — это набор связанных задач, определяющий порядок выполнения по определённому расписанию.

## Scheduler (Планировщик)
**Scheduler** — компонент, отвечающий за планирование задач и определение, когда они должны быть выполнены.

### Основные функции:
- Чтение DAG;
- Определение зависимостей между задачами;
- Распределение задач на выполнение через **Executor**;
- Контроль статусов задач (успех, неудача, пропуск и т. д.).

---

## Executor (Исполнитель)
**Executor** отвечает за выполнение задач, определённых в DAG. Это абстракция, которая управляет, где и как задачи запускаются.

### Виды Executors:
- **SequentialExecutor**
  - Используется по умолчанию;
  - Работает на одном процессе, выполняя задачи последовательно;
  - Подходит для локальной разработки и тестирования.
- **LocalExecutor**
  - Выполняет задачи параллельно, используя несколько процессов;
  - Подходит для небольших рабочих нагрузок.
- **CeleryExecutor**
  - Использует очередь задач (RabbitMQ, Redis) и несколько воркеров для выполнения задач;
  - Подходит для распределённых систем с высокой нагрузкой.
- **KubernetesExecutor**
  - Запускает каждую задачу в отдельном Kubernetes-поде;
  - Подходит для облачных и контейнеризированных сред.
- **CustomExecutor**
  - Позволяет создавать собственные Executors.

---

## Worker (Воркеры)
**Worker** — компонент, который выполняет задачи, отправленные ему Executor-ом.

### Типы воркеров:
- **LocalExecutor** — работает на том же сервере, где установлен Airflow.
- **CeleryExecutor** — каждый воркер — это отдельный процесс/сервер, подключённый к очереди задач.
- **KubernetesExecutor** — каждый воркер — это отдельный под в Kubernetes.

---

## Operator (Оператор)
**Operator** — сущность, на основании которой создаются экземпляры заданий. Она описывает, что будет происходить во время исполнения.

### Примеры операторов:
- **BashOperator** — выполнение bash-команд;
- **PythonOperator** — выполнение Python-кода;
- **EmailOperator** — отправка Email;
- **HTTPOperator** — работа с HTTP-запросами;
- **SqlOperator** — выполнение SQL-кода;
- **Sensor** — ожидание события (например, появления данных в БД);
- **DockerOperator** — работа с Docker-контейнерами;
- **HiveOperator** — работа с Hive.

---

## Variables (Переменные)
**Variables** используются для хранения и извлечения конфигурационных значений, которые могут быть использованы в разных частях DAG-а.

### Особенности:
- Переменные могут быть глобальными и доступными во всей системе Airflow;
- Могут содержать различные типы данных: JSON-объекты, списки;
- Хранятся в БД Airflow, что позволяет получить доступ из любой части DAG-а;
- Используются для централизованного хранения конфигураций (учётные данные, пути к файлам и т. д.).

---

## Params (Параметры задачи)
**Params** — это параметры, передаваемые задачам DAG-а, которые задают значения для конкретных задач в момент выполнения.

### Особенности:
- Передаются через параметр `params` в контексте выполнения DAG-а;
- Используются для динамического формирования SQL-запросов или других гибких задач.

---

### Сравнение Variables и Params

| **Особенность**       | **Variables**                           | **Params**                                  |
|------------------------|-----------------------------------------|---------------------------------------------|
| **Где используются**  | Глобальные значения для всех DAG-ов     | Локальные значения для конкретной задачи    |
| **Передаются через**  | CLI, Web UI, `Variable.get()`           | `conf` при запуске DAG или через `params`   |
| **Доступность**       | Глобально в DAG, Task или системе       | Только в контексте конкретной задачи или DAG|
| **Использование**     | Для конфигураций, которые редко меняются| Для параметров, изменяемых при запуске задач|
| **Типы данных**       | Строки, числа, JSON, списки             | JSON, строки, числа                         |

---

## XCom (Cross-communication)
**XCom** — механизм, позволяющий задачам обмениваться данными в рамках одного DAG-а.

### Основные особенности:
- XCom используется для передачи данных (строки, числа, списки, словари и т. д.) между задачами;
- Работает через БД метаданных Airflow, где хранятся записи о переданных данных;
- Поддерживает передачу сложных объектов (например, JSON).

### Работа XCom:
- **push**: передача данных через метод `xcom_push()`;
- **pull**: получение данных через метод `xcom_pull()`.


